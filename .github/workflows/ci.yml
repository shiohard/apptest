name: Python Test Assignment

# 触发条件：每次 push 代码时自动运行
on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      # 第一步：拉取仓库代码
      - uses: actions/checkout@v4

      # 第二步：搭建 Python 3.11 环境
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # 第三步：安装依赖
      # (注意：确保您的 requirements.txt 里已经包含了 pytest, pytest-html, requests, flask)
      - run: pip install -r requirements.txt

      # 第四步：运行测试并生成 HTML 报告
      - run: pytest --html=report.html --self-contained-html

      # 第五步：上传测试报告 (新增功能)
      # 即使测试失败，也会执行这一步，方便您下载报告查看错误原因
      - name: Upload Test Report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-report   # 下载下来的压缩包名字
          path: report.html   # 要上传的文件路径